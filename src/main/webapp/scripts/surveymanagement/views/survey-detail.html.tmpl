<div ng-if="ctrl.survey.id">
  <previous-search-result bowser="bowser" current-language="currentLanguage"></previous-search-result>
  <next-search-result bowser="bowser" current-language="currentLanguage"></next-search-result>
  <div class="fdz-cc" ng-if="!isAuthenticated()">
    <div>
      <div class="fdz-detail">
        <div class="fdz-detail__header">
          <h1 class="md-headline" display-i18n-string="ctrl.survey.title" fdz-hyphenate></h1>
        </div>
        <fdz-detail
          collapsed="false"
          lang="currentLanguage"
          options="ctrl"
          template-url="scripts/surveymanagement/templates/dp-detail.html.tmpl"></fdz-detail>
        <fdz-related-objects
          collapsed="false"
          lang="currentLanguage"
          options="ctrl.counts"
          id="ctrl.survey.id"
          template-url="scripts/common/detail/common/dp-related-objects.html.tmpl"></fdz-related-objects>
        <fdz-detail
          ng-if="ctrl.attachments && ctrl.attachments.length > 0"
          collapsed="false"
          lang="currentLanguage"
          options="ctrl.attachments"
          template-url="scripts/studymanagement/templates/dp-attachments.html.tmpl"></fdz-detail>
      </div>
    </div>
  </div>

  <div class="fdz-cc" ng-if="isAuthenticated()">
    <div layout="row" layout-margin style="margin-bottom: 0px;">
      <h1 class="md-headline fdz-headline">
        <span display-i18n-string="ctrl.survey.title" fdz-hyphenate></span>
        <span class="label label-as-badge label-default">{{ctrl.survey.masterId}}</span>
      </h1>
      <json-content-dialog class="mb0" content="ctrl.survey" exclude-fields="ctrl.jsonExcludes"
                           header-title="ctrl.survey.title" ng-if="ctrl.enableJsonView"></json-content-dialog>
    </div>
    <div layout="column" layout-gt-sm="row">
      <div flex-gt-sm="50" layout="column">
        <md-card flex="auto">
          <md-card-header>
            <md-card-header-text>
              <h2 class="md-title">{{'global.cards.details' | translate }}</h2>
            </md-card-header-text>
          </md-card-header>
          <md-divider></md-divider>
          <md-card-content class="pt16">
            <div class="fdz-add-bottom-margin fdz-text-block" ng-if="ctrl.survey.population">
              <span style="font-weight: bold;">{{'survey-management.detail.label.population' | translate }}:</span>
              <span class="fdz-multiline-property" display-i18n-string="ctrl.survey.population.description"
                    fdz-hyphenate></span>
            </div>
            <div class="fdz-add-bottom-margin fdz-text-block" ng-if="ctrl.survey.population.unit">
              <span style="font-weight: bold;">{{'survey-management.detail.label.unit' | translate }}:</span>
              <span class="fdz-multiline-property" display-i18n-string="ctrl.survey.population.unit"
                    fdz-hyphenate></span>
            </div>
            <div class="fdz-add-bottom-margin" ng-if="ctrl.survey.dataType">
              <span style="font-weight: bold;">{{'survey-management.detail.label.data-type' | translate }}:</span>
              <span display-i18n-string="ctrl.survey.dataType" fdz-hyphenate></span>
            </div>
            <div class="fdz-add-bottom-margin" ng-if="ctrl.survey.sample">
              <span style="font-weight: bold;">{{'survey-management.detail.label.sample' | translate }}:</span>
              <span display-i18n-string="ctrl.survey.sample" fdz-hyphenate></span>
            </div>
            <div class="fdz-add-bottom-margin" ng-if="ctrl.survey.surveyMethod">
              <span style="font-weight: bold;">{{'survey-management.detail.label.survey-method' | translate }}:</span>
              <span display-i18n-string="ctrl.survey.surveyMethod" fdz-hyphenate></span>
            </div>
            <div class="fdz-add-bottom-margin" ng-if="ctrl.survey.fieldPeriod">
              <span style="font-weight: bold;">{{'survey-management.detail.label.field-period' | translate }}:</span>
              <span>{{ctrl.survey.fieldPeriod.start | date}} - {{ctrl.survey.fieldPeriod.end | date}}</span>
            </div>
            <div class="fdz-add-bottom-margin" ng-if="ctrl.survey.grossSampleSize">
              <span style="font-weight: bold;">{{'survey-management.detail.label.grossSampleSize' | translate }}:</span>
              <span>n = {{ctrl.survey.grossSampleSize | number}}</span>
            </div>
            <div class="fdz-add-bottom-margin" ng-if="ctrl.survey.sampleSize">
              <span style="font-weight: bold;">{{'survey-management.detail.label.sampleSize' | translate }}:</span>
              <span>n = {{ctrl.survey.sampleSize | number}}</span>
            </div>
            <div class="fdz-add-bottom-margin" ng-if="ctrl.survey.responseRate">
              <span style="font-weight: bold;">{{'survey-management.detail.label.responseRate' | translate }}:</span>
              <span>{{ctrl.survey.responseRate | number}}%</span>
            </div>
            <div class="fdz-add-bottom-margin fdz-text-block" ng-if="ctrl.survey.annotations">
              <span style="font-weight: bold;">{{'survey-management.detail.label.annotations' | translate }}:</span>
              <span class="fdz-multiline-property" display-i18n-string="ctrl.survey.annotations" fdz-hyphenate></span>
            </div>
            <div class="fdz-add-bottom-margin fdz-text-block"
                 ng-if="ctrl.isSimpleGeographicCoverage(ctrl.survey.population.geographicCoverages)">
              <span
                style="font-weight: bold;">{{'survey-management.detail.label.geographic-coverage' | translate }}:</span>
              <span>{{ctrl.getCountryName(ctrl.survey.population.geographicCoverages[0])}}</span>
            </div>
          </md-card-content>
        </md-card>
      </div>
      <div flex-gt-sm="50" layout="column">
        <md-card flex="auto"
                 ng-class="{'fdz-reset-left-margin': $mdMedia('gt-sm'), 'fdz-reset-top-margin': $mdMedia('sm') || $mdMedia('xs')}">
          <md-card-header>
            <md-card-header-text>
              <h2 class="md-title">{{'global.cards.related-objects' | translate }}</h2>
            </md-card-header-text>
          </md-card-header>
          <md-divider></md-divider>
          <md-card-content layout="column" layout-align="center start" class="pt16">
            <div layout="row" style="margin-bottom: 0.5em; width: 100%;">
              <div class="fdz-truncate-string" flex ng-if="!ctrl.study">
                <md-icon md-svg-src="/assets/images/icons/study.svg"></md-icon>
                {{'study-management.detail.label.study' | translate }}: {{'global.messages.error.unavailable' |
                translate}}
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.study">
                <a
                  ui-sref="studyDetail({id: ctrl.study.masterId, version: ctrl.survey.shadow?ctrl.survey.release.version:''})">
                  <md-icon md-svg-src="/assets/images/icons/study.svg"></md-icon>
                  {{'study-management.detail.label.study' | translate }}:
                  <span display-i18n-string="ctrl.study.title"></span>
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.studies.one' | translate}}
                  </md-tooltip>
                </a>
              </div>
            </div>
            <div layout="row" style="margin-bottom: 0.5em; width: 100%;">
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.instrumentsCount == 0">
                <md-icon md-svg-src="/assets/images/icons/instrument.svg"></md-icon>
                {{'instrument-management.detail.label.instruments' | translate }}:
                {{'global.messages.error.undocumented' | translate}}
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.instrumentsCount === 1 && ctrl.instrument">
                <a
                  ui-sref="instrumentDetail({'id': ctrl.instrument.masterId, version: ctrl.survey.shadow?ctrl.survey.release.version:''})">
                  <md-icon md-svg-src="/assets/images/icons/instrument.svg"></md-icon>
                  {{'instrument-management.detail.label.instrument' | translate }}:
                  <span display-i18n-string="ctrl.instrument.description"></span>
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.instruments.one' | translate}}
                  </md-tooltip>
                </a>
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.instrumentsCount > 1">
                <a ui-sref="search({'type': 'instruments', 'survey':ctrl.survey.id, 'study': ctrl.survey.studyId})">
                  <md-icon md-svg-src="/assets/images/icons/instrument.svg"></md-icon>
                  {{'instrument-management.detail.label.instruments' | translate }}: ({{ctrl.counts.instrumentsCount}})
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.instruments.many' | translate}}
                  </md-tooltip>
                </a>
              </div>
            </div>
            <div layout="row" style="margin-bottom: 0.5em; width: 100%;">
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.questionsCount == 0">
                <md-icon md-svg-src="/assets/images/icons/question.svg"></md-icon>
                {{'question-management.detail.label.questions' | translate }}: {{'global.messages.error.undocumented' |
                translate}}
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.questionsCount === 1 && ctrl.question">
                <a
                  ui-sref="questionDetail({'id': ctrl.question.masterId, version: ctrl.survey.shadow?ctrl.survey.release.version:''})">
                  <md-icon md-svg-src="/assets/images/icons/question.svg"></md-icon>
                  {{'question-management.detail.label.question' | translate }}:
                  <span display-i18n-string="ctrl.question.questionText"></span>
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.questions.one' | translate}}
                  </md-tooltip>
                </a>
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.questionsCount > 1">
                <a ui-sref="search({'type': 'questions', 'survey':ctrl.survey.id, 'study': ctrl.survey.studyId})">
                  <md-icon md-svg-src="/assets/images/icons/question.svg"></md-icon>
                  {{'question-management.detail.label.questions' | translate }}: ({{ctrl.counts.questionsCount}})
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.questions.many' | translate}}
                  </md-tooltip>
                </a>
              </div>
            </div>
            <div layout="row" style="margin-bottom: 0.5em; width: 100%;">
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.dataSetsCount == 0">
                <md-icon md-svg-src="/assets/images/icons/data-set.svg"></md-icon>
                {{'data-set-management.detail.label.data-sets' | translate }}: {{'global.messages.error.undocumented' |
                translate}}
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.dataSetsCount == 1 && ctrl.dataSet">
                <a
                  ui-sref="dataSetDetail({'id': ctrl.dataSet.masterId, version: ctrl.survey.shadow?ctrl.survey.release.version:''})">
                  <md-icon md-svg-src="/assets/images/icons/data-set.svg"></md-icon>
                  {{'data-set-management.detail.label.data-set' | translate }}:
                  <span display-i18n-string="ctrl.dataSet.description"></span>
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.data-sets.one' | translate}}
                  </md-tooltip>
                </a>
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.dataSetsCount > 1">
                <a ui-sref="search({'type': 'data_sets', 'survey':ctrl.survey.id, 'study': ctrl.survey.studyId})">
                  <md-icon md-svg-src="/assets/images/icons/data-set.svg"></md-icon>
                  {{'data-set-management.detail.label.data-sets' | translate }}: ({{ctrl.counts.dataSetsCount}})
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.data-sets.many' | translate}}
                  </md-tooltip>
                </a>
              </div>
            </div>
            <div layout="row" ng-if="ctrl.counts.surveysCount !== 1" style="margin-bottom: 0.5em; width: 100%;">
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.surveysCount == 0">
                <md-icon md-svg-src="/assets/images/icons/survey.svg"></md-icon>
                {{'survey-management.detail.label.surveys-same-study' | translate }}:
                {{'global.messages.error.undocumented' | translate}}
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.surveysCount > 1">
                <a ui-sref="search({'type': 'surveys', 'study':ctrl.survey.studyId})">
                  <md-icon md-svg-src="/assets/images/icons/survey.svg"></md-icon>
                  {{'survey-management.detail.label.surveys-same-study' | translate }}: ({{ctrl.counts.surveysCount}})
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.surveys.many' | translate}}
                  </md-tooltip>
                </a>
              </div>
            </div>
            <div layout="row" style="margin-bottom: 0.5em; width: 100%;">
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.publicationsCount == 0">
                <md-icon md-svg-src="/assets/images/icons/related-publication.svg"></md-icon>
                {{'related-publication-management.detail.label.publications' | translate }}:
                {{'global.messages.error.undocumented' | translate}}
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.publicationsCount == 1">
                <a ui-sref="relatedPublicationDetail({'id': ctrl.relatedPublication.id})">
                  <md-icon md-svg-src="/assets/images/icons/related-publication.svg"></md-icon>
                  {{'related-publication-management.detail.label.publication' | translate }}:
                  {{ctrl.relatedPublication.title}}
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.publications.one' | translate}}
                  </md-tooltip>
                </a>
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.publicationsCount > 1">
                <a
                  ui-sref="search({'type': 'related_publications', 'survey': ctrl.survey.id, 'study': ctrl.survey.studyId})">
                  <md-icon md-svg-src="/assets/images/icons/related-publication.svg"></md-icon>
                  {{'related-publication-management.detail.label.publications' | translate }}:
                  ({{ctrl.counts.publicationsCount}})
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.publications.many' | translate}}
                  </md-tooltip>
                </a>
              </div>
            </div>
            <div layout="row" style="margin-bottom: 0.5em; width: 100%;">
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.conceptsCount == 0">
                <md-icon md-svg-src="/assets/images/icons/concept.svg"></md-icon>
                {{'concept-management.detail.label.concepts' | translate }}: {{'global.messages.error.undocumented' |
                translate}}
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.conceptsCount == 1">
                <a ui-sref="conceptDetail({'id': ctrl.concept.id})">
                  <md-icon md-svg-src="/assets/images/icons/concept.svg"></md-icon>
                  {{'concept-management.detail.label.concept' | translate }}:
                  <span display-i18n-string="ctrl.concept.title"></span>
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.concepts.one' | translate}}
                  </md-tooltip>
                </a>
              </div>
              <div class="fdz-truncate-string" flex ng-if="ctrl.counts.conceptsCount > 1">
                <a ui-sref="search({'type': 'concepts', 'survey':ctrl.survey.id, 'study': ctrl.survey.studyId})">
                  <md-icon md-svg-src="/assets/images/icons/concept.svg"></md-icon>
                  {{'concept-management.detail.label.concepts' | translate }}: ({{ctrl.counts.conceptsCount}})
                  <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                    {{'survey-management.detail.tooltips.concepts.many' | translate}}
                  </md-tooltip>
                </a>
              </div>
            </div>
          </md-card-content>
        </md-card>
      </div>
    </div>
    <div layout="row">
      <md-card class="fdz-reset-top-margin" flex ng-if="ctrl.attachments">
        <md-card-header layout-align="center center">
          <md-card-header-text>
            <h2 class="md-title">{{'survey-management.detail.attachments.table-title' | translate | fdzHyphenate }}</h2>
          </md-card-header-text>
        </md-card-header>
        <table fdz-table>
          <thead>
          <tr>
            <th class="fdz-table-half-absorbing-column">{{'survey-management.detail.label.attachments.title' | translate
              }}
              <md-tooltip hide-gt-xs md-direction="right">
                {{'survey-management.detail.label.attachments.title' | translate }}
              </md-tooltip>
            </th>
            <th class="fdz-table-half-absorbing-column">{{'survey-management.detail.label.attachments.description' |
              translate }}
              <md-tooltip hide-gt-xs md-direction="right">
                {{'survey-management.detail.label.attachments.description' | translate }}
              </md-tooltip>
            </th>
            <th>{{'survey-management.detail.label.attachments.language' | translate }}
              <md-tooltip hide-gt-xs md-direction="right">
                {{'survey-management.detail.label.attachments.language' | translate }}
              </md-tooltip>
            </th>
            <th>{{'survey-management.detail.label.attachments.file' | translate }}
              <md-tooltip hide-gt-xs md-direction="right">
                {{'survey-management.detail.label.attachments.file' | translate }}
              </md-tooltip>
            </th>
          </tr>
          </thead>
          <tbody>
          <tr ng-repeat="row in ctrl.attachments">
            <td lang="{{row.language}}">{{row.title}}&nbsp;</td>
            <td class="fdz-text-block" display-i18n-string="row.description" fdz-hyphenate></td>
            <td>{{row.language | displayIsoLanguage: currentLanguage}}&nbsp;</td>
            <td style="white-space: nowrap;"><a ng-href="{{row.id}}" target="_blank">{{row.fileName}}
              <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
                {{'global.tooltips.files.download' | translate: {filename: row.fileName} }}
              </md-tooltip>
            </a>&nbsp;
            </td>
          </tr>
          </tbody>
        </table>
      </md-card>
    </div>
    <div layout="column" layout-gt-sm="row">
      <div flex-gt-sm="50" ng-if="ctrl.responseRateImage">
        <md-card class="fdz-reset-top-margin">
          <md-card-header>
            <md-card-header-text>
              <h2 class="md-title">{{'survey-management.detail.response-rate-information' | translate | fdzHyphenate
                }}</h2>
            </md-card-header-text>
          </md-card-header>
          <md-divider></md-divider>
          <a
            ng-href="{{'/public/files/surveys/' + ctrl.survey.id + '/' + ctrl.survey.number + '_responserate_' + currentLanguage}}"
            target="_blank">
            <img alt="{{'survey-management.detail.response-rate-information-alt-text' | translate}}" ngf-src="ctrl.responseRateImage"
                 src=""
                 style="width:100%;top:0;left:0;bottom:0;right:0;"/>
            <md-tooltip md-autohide="true" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
              {{'global.tooltips.images' | translate}}
            </md-tooltip>
          </a>
        </md-card>
      </div>
      <div flex-gt-sm="50" ng-if="!ctrl.isSimpleGeographicCoverage(ctrl.survey.population.geographicCoverages)">
        <md-card class="fdz-reset-top-margin"
                 ng-class="{'fdz-reset-left-margin': $mdMedia('gt-sm') && ctrl.responseRateImage}">
          <md-card-header layout-align="center center">
            <md-card-header-text>
              <h2 class="md-title">{{'survey-management.detail.label.geographic-coverages' | translate}}</h2>
            </md-card-header-text>
          </md-card-header>
          <md-divider></md-divider>
          <md-card-content>
            <ul class="fdz-plain-list">
              <li ng-repeat="geographicCoverage in ctrl.survey.population.geographicCoverages">
                <geographic-coverage-display country-name="ctrl.getCountryName(geographicCoverage)"
                                             description="geographicCoverage.description"></geographic-coverage-display>
              </li>
            </ul>
          </md-card-content>
        </md-card>
      </div>
      <div flex-gt-sm="50" ng-if="!ctrl.responseRateImage || !ctrl.survey.population.geographicCoverages">
        <div class="fdz-fake-empty-card fdz-reset-top-margin"
             ng-class="{'fdz-reset-left-margin': $mdMedia('gt-sm')}"></div>
      </div>
    </div>
  </div>
  <div class="fdz-fab-button-container" layout="column">
    <md-button class="md-fab md-raised md-accent" data-has-any-authority="ROLE_PUBLISHER, ROLE_DATA_PROVIDER"
               ng-click="ctrl.surveyEdit()" ng-if="!ctrl.projectIsCurrentlyReleased">
      <md-tooltip md-autohide="true" md-direction="left" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
        {{'search-management.buttons.edit-survey-tooltip' | translate}}
      </md-tooltip>
      <md-icon md-font-set="material-icons">mode_edit</md-icon>
    </md-button>
    <md-button class="md-fab md-raised md-accent" ng-click="ctrl.addToShoppingCart($event)"
               ng-if="!ctrl.isAuthenticated() || ctrl.hasAuthority('ROLE_USER')">
      <md-tooltip md-autohide="true" md-direction="left" md-z-index="bowser.mobile || bowser.tablet ? -100 : 100001">
        {{'shopping-cart.buttons.add-study-tooltip' | translate}}
      </md-tooltip>
      <md-icon md-font-set="material-icons">add_shopping_cart</md-icon>
    </md-button>
  </div>
</div>
